; ============================================================================
; CORRECT FIX - platformio.ini v0.8.0
; Ensures LVGL finds lv_conf.h automatically (LVGL best practice)
; ============================================================================

[platformio]
default_envs = development

[common]
upload_port = COM9
monitor_port = COM9

board_build.mcu = esp32s3
board_build.f_cpu = 240000000L
board_build.flash_mode = qio
board_build.flash_size = 8MB
board_build.partitions = default.csv

lib_deps =
    lvgl/lvgl@=9.3.0
    moononournation/GFX Library for Arduino@=1.5.5
    bblanchon/ArduinoJson@^7.0.0
    
lib_ldf_mode = chain+
lib_compat_mode = soft
    
; CORRECT WAY: Add include path so LVGL finds lv_conf.h automatically
build_flags = 
    -I include                              ; ‚Üê This makes lv_conf.h findable
    -D ARDUINO_USB_CDC_ON_BOOT=1   
    -D ARDUINO_USB_MODE=1
    -D ARDUINO_LOOP_STACK_SIZE=16384
    -D SOC_SDMMC_HOST_SUPPORTED

; CRITICAL: Tell compiler to look in project include directory FIRST
build_unflags =
    -I.pio/libdeps/development/lvgl/src    ; Remove LVGL's default include path priority

monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    default
    
[env:development]
platform = espressif32@6.8.1
board = esp32-s3-devkitc-1
framework = arduino

upload_port = ${common.upload_port}
monitor_port = ${common.monitor_port}
lib_deps = ${common.lib_deps}
lib_ldf_mode = ${common.lib_ldf_mode}
lib_compat_mode = ${common.lib_compat_mode}
monitor_speed = ${common.monitor_speed}
monitor_filters = ${common.monitor_filters}

extra_scripts =
    pre:scripts/increment_build.py
    pre:scripts/extract_compiler_version.py
    pre:scripts/lvgl_build_patch.py 
    pre:scripts/eez_lvgl9_fix.py
    pre:scripts/validate_doxygen.py

build_flags = 
    ${common.build_flags}
    -D EARS_DEBUG=1
    -D EARS_DEBUG_BAUD_RATE=115200